
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-97947441-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Developer documentation &#8212; tick 0.6.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="How to use tick from the R statistical software" href="R.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="None navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          tick</a>
        <span class="navbar-text navbar-version pull-left"><b>0.6</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../index.html">Home</a></li>
                <li><a href="../auto_examples/index.html">Examples</a></li>
                <li><a href="api.html">API</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Browse <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hawkes.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.hawkes</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="hawkes.html#introduction">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="hawkes.html#learners">2. Learners</a></li>
<li class="toctree-l2"><a class="reference internal" href="hawkes.html#point-process-simulation">3. Point process simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="hawkes.html#models-for-inference">4. Models for inference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="linear_model.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.linear_model</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="linear_model.html#introduction">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="linear_model.html#learners">2. Learners</a></li>
<li class="toctree-l2"><a class="reference internal" href="linear_model.html#models">3. Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="linear_model.html#simulation">4. Simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="robust.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.robust</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="robust.html#regression-with-individual-intercepts">1. Regression with individual intercepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="robust.html#robust-losses">2. Robust losses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="survival.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.survival</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="survival.html#learners">1. Learners</a></li>
<li class="toctree-l2"><a class="reference internal" href="survival.html#models">2. Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="survival.html#simulation">3. Simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="prox.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.prox</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="prox.html#available-operators">1. Available operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="prox.html#example">2. Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="prox.html#how-to-combine-several-prox">3. How to combine several prox ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="prox.html#the-prox-class-api">4. The <code class="docutils literal notranslate"><span class="pre">prox</span></code> class API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="solver.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.solver</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="solver.html#the-solver-class-api">1. The <code class="docutils literal notranslate"><span class="pre">solver</span></code> class API</a></li>
<li class="toctree-l2"><a class="reference internal" href="solver.html#available-solvers">2. Available solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="solver.html#example">3. Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.simulation</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="simulation.html#simulation-of-model-weights">1. Simulation of model weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation.html#simulation-of-a-features-matrix">2. Simulation of a features matrix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plot.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.plot</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="plot.html#history-plot">1. History plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html#plots-for-hawkes-processes">2. Plots for Hawkes processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html#plots-for-point-process-simulation">3. Plots for point process simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html#miscellaneous-plots">4. Miscellaneous plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.dataset</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/tick.dataset.fetch_tick_dataset.html">tick.dataset.fetch_tick_dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tick.dataset.fetch_hawkes_bund_data.html">tick.dataset.fetch_hawkes_bund_data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.preprocessing</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="preprocessing.html#preprocessing-for-static-features">Preprocessing for static features</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessing.html#preprocessing-for-longitudinal-features">Preprocessing for longitudinal features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tick.metrics</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/tick.metrics.support_fdp.html">tick.metrics.support_fdp</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/tick.metrics.support_recall.html">tick.metrics.support_recall</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="R.html">How to use <code class="docutils literal notranslate"><span class="pre">tick</span></code> from the R statistical software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="R.html#training-a-logistic-regression-model">1. Training a logistic regression model</a></li>
<li class="toctree-l2"><a class="reference internal" href="R.html#simulation-of-a-hawkes-process">2. Simulation of a Hawkes process</a></li>
<li class="toctree-l2"><a class="reference internal" href="R.html#using-optimization-tools-from-r">3. Using optimization tools from R</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-highlights">Main highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="#base-class">Base class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-add-a-new-model-solver-or-prox">How to add a new model, solver or prox</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enable-python-pickling-of-c-objects">Enable Python-pickling of C++ objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tips-for-debugging-c-classes-in-tick">Tips for debugging C++ classes in tick</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#table-of-contents">Table of contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#hawkes"><span class="xref std std-ref">hawkes</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#linear-model"><span class="xref std std-ref">linear_model</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#robust"><span class="xref std std-ref">robust</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#survival"><span class="xref std std-ref">survival</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#prox"><span class="xref std std-ref">prox</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#solver"><span class="xref std std-ref">solver</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#api-simulation"><span class="xref std std-ref">simulation</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#plot"><span class="xref std std-ref">plot</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#dataset"><span class="xref std std-ref">dataset</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#preprocessing"><span class="xref std std-ref">preprocessing</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#metrics"><span class="xref std std-ref">metrics</span></a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container content-container">
  
  <div class="section" id="developer-documentation">
<span id="dev"></span><h1>Developer documentation<a class="headerlink" href="#developer-documentation" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>This page might need some update</p>
</div>
<div class="section" id="main-highlights">
<h2>Main highlights<a class="headerlink" href="#main-highlights" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Python 3 only</strong>!</p></li>
<li><p>Fast, most computation are done in C++11 (including multi-threading)</p></li>
<li><p>Interplay between Python and C++ is done using swig</p></li>
</ul>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#developer-documentation" id="id2">Developer documentation</a></p>
<ul>
<li><p><a class="reference internal" href="#main-highlights" id="id3">Main highlights</a></p></li>
<li><p><a class="reference internal" href="#base-class" id="id4">Base class</a></p>
<ul>
<li><p><a class="reference internal" href="#read-only-attributes" id="id5">Read-only attributes</a></p></li>
<li><p><a class="reference internal" href="#settable-attributes" id="id6">Settable attributes</a></p></li>
<li><p><a class="reference internal" href="#link-with-c-setter" id="id7">Link with C++ setter</a></p></li>
<li><p><a class="reference internal" href="#how-does-this-work" id="id8">How does this work?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-add-a-new-model-solver-or-prox" id="id9">How to add a new model, solver or prox</a></p>
<ul>
<li><p><a class="reference internal" href="#create-c-class" id="id10">Create C++ class</a></p></li>
<li><p><a class="reference internal" href="#link-it-with-python" id="id11">Link it with Python</a></p></li>
<li><p><a class="reference internal" href="#use-class-in-python" id="id12">Use class in Python</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#enable-python-pickling-of-c-objects" id="id13">Enable Python-pickling of C++ objects</a></p>
<ul>
<li><p><a class="reference internal" href="#splitting-serialization-and-deserialization-methods" id="id14">Splitting serialization and deserialization methods</a></p></li>
<li><p><a class="reference internal" href="#serializing-class-hierarchies" id="id15">Serializing class hierarchies</a></p></li>
<li><p><a class="reference internal" href="#serializing-smart-pointers" id="id16">Serializing smart pointers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tips-for-debugging-c-classes-in-tick" id="id17">Tips for debugging C++ classes in tick</a></p>
<ul>
<li><p><a class="reference internal" href="#debug-output" id="id18">Debug output</a></p></li>
<li><p><a class="reference internal" href="#raising-errors" id="id19">Raising errors</a></p></li>
<li><p><a class="reference internal" href="#deprecation" id="id20">Deprecation</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="base-class">
<span id="baseclass"></span><h2>Base class<a class="headerlink" href="#base-class" title="Permalink to this headline">¶</a></h2>
<p>Most of our objects inherit from <code class="xref py py-obj docutils literal notranslate"><span class="pre">tick.base.Base</span></code> class. If this class does
not have many public methods, it allow us to benefit from several behaviors.
These behaviors are deducted from a private dictionary set by developer :
<code class="xref py py-obj docutils literal notranslate"><span class="pre">_attrinfos</span></code>.</p>
<div class="section" id="read-only-attributes">
<h3>Read-only attributes<a class="headerlink" href="#read-only-attributes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="behavior">
<h4>Behavior<a class="headerlink" href="#behavior" title="Permalink to this headline">¶</a></h4>
<p>The first feature is the ability to set read-only attributes. If you think
end-user should not modify an attribute of your class, you can simply set
writable to False (writable is True by default).</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">_attrinfos</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;readonly_attr&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;writable&#39;</span> <span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
</pre></div>
</div>
<p>Then if you try to set it</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">readonly_attr</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">AttributeError</span>: <span class="n">readonly_attr is readonly in A</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-set-it-manually">
<h4>How to set it manually?<a class="headerlink" href="#how-to-set-it-manually" title="Permalink to this headline">¶</a></h4>
<p>First if you set a read-only attribute during the initialization phase (ie.
in <code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code> method or in a method called by it) you will not raise any error.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">_attrinfos</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;readonly_attr&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;writable&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readonly_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readonly_attr</span> <span class="o">=</span> <span class="n">readonly_value</span>
</pre></div>
</div>
<p>This code snippet will work as usual.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">readonly_attr</span>
<span class="go">5</span>
</pre></div>
</div>
<p>But if you need to change this attribute after the initialization phase, you
can force set it by using <code class="xref py py-obj docutils literal notranslate"><span class="pre">_set</span></code> method.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="s1">&#39;readonly_attr&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">readonly_attr</span>
<span class="go">10</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="settable-attributes">
<h3>Settable attributes<a class="headerlink" href="#settable-attributes" title="Permalink to this headline">¶</a></h3>
<p>Base class also restricts which attributes can be set. Attributes that can be
set are:</p>
<ul class="simple">
<li><p>Attributes contained in <code class="xref py py-obj docutils literal notranslate"><span class="pre">_attrinfos</span></code> dictionary</p></li>
<li><p>Attributes documented in class docstring (with numpydoc style)</p></li>
<li><p>Attributes passed as argument to <code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code></p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When you document an attribute with numpydoc style, do not forget the
space before the colon that follow its name.</p>
</div>
<p>Hence, if an attribute was never mentioned in your class before, trying to
set it will raise an exception.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is an awesome class that inherits from Base</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    documented_parameter : `int`</span>
<span class="sd">        This is a documented parameter of my class</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    documented_attribute : `string`</span>
<span class="sd">        This is a documented attribute of my class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_attrinfos</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;attr_in_attrinfos&#39;</span> <span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documented_parameter</span><span class="p">,</span> <span class="n">undocumented_parameter</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>The following will work as expected</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">documented_parameter</span> <span class="o">=</span> <span class="mi">32</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">documented_attribute</span> <span class="o">=</span> <span class="s1">&#39;bananas&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">undocumented_parameter</span> <span class="o">=</span> <span class="s1">&#39;are too many&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">documented_parameter</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">documented_attribute</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">undocumented_parameter</span>
<span class="go">(32, &#39;bananas&#39;, &#39;are too many&#39;)</span>
</pre></div>
</div>
<p>But this raises an error</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">unexisting_attr</span> <span class="o">=</span> <span class="mi">25</span>
<span class="gt">Traceback (most recent call last):</span>
 <span class="c">...</span>
<span class="gr">AttributeError</span>: <span class="n">&#39;A&#39; object has no settable attribute &#39;unexisting_attr&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="link-with-c-setter">
<h3>Link with C++ setter<a class="headerlink" href="#link-with-c-setter" title="Permalink to this headline">¶</a></h3>
<p>Another useful feature is the possibility to add a direct linking between a
Python attribute and its C++ equivalent.</p>
<p>In many cases our code consists in a Python object which encompasses a C++
object used for intense computations. Find more details in the SWIG part
of this documentation. In this setting we might want to update our C++ object
each time our Python object is. We can do so by specifying which setter to
call when an attribute is modified in Python.</p>
<p>For this example, let’s suppose we have a C++ class (named <code class="xref py py-obj docutils literal notranslate"><span class="pre">_A</span></code>) that has a int
attribute associated to a setter (<code class="xref py py-obj docutils literal notranslate"><span class="pre">set_cpp_int</span></code>) and a getter (<code class="xref py py-obj docutils literal notranslate"><span class="pre">get_cpp_int</span></code>).
In order to enable the linking we must specify:</p>
<ul class="simple">
<li><p>What is the C++ object’s name, through <code class="xref py py-obj docutils literal notranslate"><span class="pre">_cpp_obj_name</span></code> attribute of the class</p></li>
<li><p>What is the C++ method that sets attribute <code class="xref py py-obj docutils literal notranslate"><span class="pre">cpp_int</span></code>, through <code class="xref py py-obj docutils literal notranslate"><span class="pre">cpp_setter</span></code>
in <code class="xref py py-obj docutils literal notranslate"><span class="pre">_attrinfos</span></code> dictionary</p></li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">_attrinfos</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cpp_int&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cpp_setter&#39;</span><span class="p">:</span> <span class="s1">&#39;set_cpp_int&#39;</span><span class="p">},</span>
        <span class="s1">&#39;_a&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;writable&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
    <span class="p">}</span>
    <span class="n">_cpp_obj_name</span> <span class="o">=</span> <span class="s2">&quot;_a&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">_A</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_int</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Now each time we will modify <code class="xref py py-obj docutils literal notranslate"><span class="pre">cpp_int</span></code> attribute of an instance of the class
<code class="xref py py-obj docutils literal notranslate"><span class="pre">A</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">set_cpp_int</span></code> method of the C++ object will be called and modify the
value of the C++ int.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">cpp_int</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">_a</span><span class="o">.</span><span class="n">get_cpp_int</span><span class="p">()</span>
<span class="go">(0, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">cpp_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">cpp_int</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">_a</span><span class="o">.</span><span class="n">get_cpp_int</span><span class="p">()</span>
<span class="go">(-4, -4)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the reader wants to run this example, he might find the corresponding
class by importing it <code class="xref py py-obj docutils literal notranslate"><span class="pre">from</span> <span class="pre">tick.base.utils.build.utils</span> <span class="pre">import</span> <span class="pre">A0</span> <span class="pre">as</span> <span class="pre">_A</span></code>.</p>
</div>
</div>
<div class="section" id="how-does-this-work">
<h3>How does this work?<a class="headerlink" href="#how-does-this-work" title="Permalink to this headline">¶</a></h3>
<p>This class behavior is obtained thanks to Python metaclasses. A metaclass is
the object that is called to create the class object itself. For example, it
allow us to automatize property creation. For more information, please report
to <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#customizing-class-creation">Python documentation</a>.</p>
<p>What we do is creating a property for each attribute. This property is linked
to a hidden attribute, stored with the same name of the property with a
double underscore before</p>
<p>If we create the following class <code class="xref py py-obj docutils literal notranslate"><span class="pre">A</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span>
</pre></div>
</div>
<p>We have access to the property <code class="xref py py-obj docutils literal notranslate"><span class="pre">attr</span></code> and its linked attribute <code class="xref py py-obj docutils literal notranslate"><span class="pre">__attr</span></code>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">__attr</span>
<span class="go">(15, 15)</span>
</pre></div>
</div>
<p>Two good practises to avoid unexpected behaviors:</p>
<ul class="simple">
<li><p>Do not define an attribute that starts with a double underscore</p></li>
<li><p>Add property documentation in class docstring instead of property getter</p></li>
</ul>
</div>
</div>
<div class="section" id="how-to-add-a-new-model-solver-or-prox">
<h2>How to add a new model, solver or prox<a class="headerlink" href="#how-to-add-a-new-model-solver-or-prox" title="Permalink to this headline">¶</a></h2>
<p>Many of our models, prox and solvers are Python classes that wraps a C++ class
which handles the heavy computations. This allows us to have a code that runs
fast.</p>
<p>Let’s see what we should do if we want to add prox L2. Adding a model or a
solver is basically identical.</p>
<div class="section" id="create-c-class">
<h3>Create C++ class<a class="headerlink" href="#create-c-class" title="Permalink to this headline">¶</a></h3>
<p>First we need to create the C++ class that will be wrapped by our Python
class later. We want our prox to be able to give the value of the
penalization at a given point and call the proximal operator on a given vector.</p>
<p>Here is what our .h file should look like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProxL2Sq</span> <span class="p">{</span>

<span class="k">protected</span><span class="o">:</span>
    <span class="kt">double</span> <span class="n">strength</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">ProxL2Sq</span><span class="p">(</span><span class="kt">double</span> <span class="n">strength</span><span class="p">);</span>
    <span class="kt">double</span> <span class="nf">value</span><span class="p">(</span><span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">coeffs</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">coeffs</span><span class="p">,</span> <span class="kt">double</span> <span class="n">step</span><span class="p">,</span> <span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_strength</span><span class="p">(</span><span class="kt">double</span> <span class="n">strength</span><span class="p">){</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">strength</span> <span class="o">=</span> <span class="n">strength</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Basically we have one constructor that set the only one parameter strength
(usually denoted by lambda), and the two methods we described above.</p>
<p>Our .cpp implementation looks like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;prox_l2sq.h&quot;</span><span class="cp"></span>

<span class="n">ProxL2Sq</span><span class="o">::</span><span class="n">ProxL2Sq</span><span class="p">(</span><span class="kt">double</span> <span class="n">strength</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">strength</span> <span class="o">=</span> <span class="n">strength</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">ProxL2Sq</span><span class="o">::</span><span class="n">value</span><span class="p">(</span><span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">coeffs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">coeffs</span><span class="p">.</span><span class="n">normsq</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ProxL2Sq</span><span class="o">::</span><span class="n">call</span><span class="p">(</span><span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">coeffs</span><span class="p">,</span> <span class="kt">double</span> <span class="n">step</span><span class="p">,</span> <span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">coeffs</span><span class="p">.</span><span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">strength</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In tick these files are stored in the lib/cpp and lib/include folders</p>
</div>
<div class="section" id="link-it-with-python">
<h3>Link it with Python<a class="headerlink" href="#link-it-with-python" title="Permalink to this headline">¶</a></h3>
<div class="section" id="create-swig-file">
<h4>Create SWIG file<a class="headerlink" href="#create-swig-file" title="Permalink to this headline">¶</a></h4>
<p>Now that our proximal operator is defined in C++ we need to make it available
in Python. We do it thanks to <a class="reference external" href="http://www.swig.org/Doc4.0/">SWIG</a>.
Hence we have to create a .i file. In tick we store them in the lib/swig folder.</p>
<p>This .i file looks a lot like our .h file.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">std_shared_ptr</span><span class="p">.</span><span class="n">i</span><span class="o">&gt;</span>
<span class="o">%</span><span class="n">shared_ptr</span><span class="p">(</span><span class="n">ProxL2Sq</span><span class="p">);</span>

<span class="o">%</span><span class="p">{</span>
<span class="cp">#include</span> <span class="cpf">&quot;prox_l2sq.h&quot;</span><span class="cp"></span>
<span class="o">%</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">ProxL2Sq</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">ProxL2Sq</span><span class="p">(</span><span class="kt">double</span> <span class="n">strength</span><span class="p">);</span>
    <span class="kt">double</span> <span class="nf">value</span><span class="p">(</span><span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">coeffs</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">coeffs</span><span class="p">,</span> <span class="kt">double</span> <span class="n">step</span><span class="p">,</span> <span class="n">ArrayDouble</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">set_strength</span><span class="p">(</span><span class="kt">double</span> <span class="n">strength</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In this file our goal is to explain to Python what it can do with this class. In
our example it will be able to instantiate it by calling its constructor
with a double, and call three methods, <code class="xref py py-obj docutils literal notranslate"><span class="pre">value</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">call</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">set_strength</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>There is no interest in mentioning here any private method or attribute of
the class as this is what Python see and Python would not be able to call
them.</p></li>
<li><p>We need to include the file in which is declared the class we are talking
about in the .i file. This what we do with <code class="xref py py-obj docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;prox_l2sq.h&quot;</span></code>.</p></li>
<li><p>Finally, as we will want to share our proximal operator and as it might be
used by several objects, we wrap it in class from the standard library: the
shared pointer. To make SWIG aware that this class will be used with shared
pointers we must add <code class="xref py py-obj docutils literal notranslate"><span class="pre">%shared_ptr(ProxL2Sq);</span></code> which must be done after
<code class="xref py py-obj docutils literal notranslate"><span class="pre">%include</span> <span class="pre">&lt;std_shared_ptr.i&gt;</span></code>.</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In tick our ProxL2Sq class is not really identical as it inherits
from Prox abstract class. Hence some of this logic might not be present in
the exact same file. Everything that concerns prox, is imported through
<code class="xref py py-obj docutils literal notranslate"><span class="pre">prox_module.i</span></code>.</p>
</div>
</div>
<div class="section" id="reference-it-in-python-build">
<h4>Reference it in Python build<a class="headerlink" href="#reference-it-in-python-build" title="Permalink to this headline">¶</a></h4>
<p>Now that we have written our .i file we should add our files to our python
script that builds the extension : <code class="xref py py-obj docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<p>Most of the time, we add a file that belongs to a module that has already
been created. In this case we only need to add its source files at the right
place in <code class="xref py py-obj docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<p>Let’s supposed we already had two prox in our module (abstract class Prox and
prox L1), we need to add <code class="xref py py-obj docutils literal notranslate"><span class="pre">prox_l2sq.cpp</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">prox_l2sq.h</span></code> that we have just
created at the following place.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prox_core_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cpp_files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;prox.cpp&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;prox_l1.cpp&quot;</span><span class="p">,</span>
<span class="hll">                  <span class="s2">&quot;prox_l2sq.cpp&quot;</span><span class="p">],</span>
</span>    <span class="s2">&quot;h_files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;prox.h&quot;</span><span class="p">,</span>
                <span class="s2">&quot;prox_l1.h&quot;</span><span class="p">,</span>
<span class="hll">                <span class="s2">&quot;prox_l2sq.h&quot;</span><span class="p">],</span>
</span>    <span class="s2">&quot;swig_files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;prox_module.i&quot;</span><span class="p">,</span> <span class="p">],</span>
    <span class="s2">&quot;module_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;./tick/optim/prox/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;extension_name&quot;</span><span class="p">:</span> <span class="s2">&quot;prox&quot;</span><span class="p">,</span>
    <span class="s2">&quot;include_modules&quot;</span><span class="p">:</span> <span class="n">base_modules</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We do not need to add <code class="xref py py-obj docutils literal notranslate"><span class="pre">prox_l2sq.i</span></code> file here as it is imported
in <code class="xref py py-obj docutils literal notranslate"><span class="pre">prox_module.i</span></code> with a <code class="xref py py-obj docutils literal notranslate"><span class="pre">%include</span></code> operator. This operator works like a
copy/paste of the code of the included file.</p>
</div>
</div>
</div>
<div class="section" id="use-class-in-python">
<h3>Use class in Python<a class="headerlink" href="#use-class-in-python" title="Permalink to this headline">¶</a></h3>
<p>Now that our C++ class is linked with Python we can import it and use its
methods that we have declared in the .i file.</p>
<p>In tick we always wrap C++ classes in a Python class that will call C++
object methods when it needs to perform the computations. Hence here is the
Python class we might create:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.build.prox</span> <span class="kn">import</span> <span class="n">ProxL2Sq</span> <span class="k">as</span> <span class="n">_ProxL2sq</span>

<span class="k">class</span> <span class="nc">ProxL2Sq</span><span class="p">:</span>
    <span class="n">_attrinfos</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;strength&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;cpp_setter&quot;</span><span class="p">:</span> <span class="s2">&quot;set_strength&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">_cpp_obj_name</span> <span class="o">=</span> <span class="s2">&quot;_prox&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strength</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prox</span> <span class="o">=</span> <span class="n">_ProxL2sq</span><span class="p">(</span><span class="n">strength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strength</span> <span class="o">=</span> <span class="n">strength</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prox</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</pre></div>
</div>
<p>You might have seen that we instantiate a dictionary called <code class="xref py py-obj docutils literal notranslate"><span class="pre">_attrinfos</span></code> in
the class declaration. This dictionary is useful in many ways and you should
refer to <a class="reference internal" href="#baseclass">BaseClass</a>. Here we use one of
its functionalities: automatic set of C++ attributes. Each time <code class="xref py py-obj docutils literal notranslate"><span class="pre">strength</span></code> of
our prox will be modified, the <code class="xref py py-obj docutils literal notranslate"><span class="pre">set_strength</span></code> method of the object stored in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">_prox</span></code> attribute (as specified by <code class="xref py py-obj docutils literal notranslate"><span class="pre">_cpp_obj_name</span></code> will be called with the
new value passed as argument). This allow us to have strength values of
Python and C++ that are always linked.</p>
</div>
</div>
<div class="section" id="enable-python-pickling-of-c-objects">
<h2>Enable Python-pickling of C++ objects<a class="headerlink" href="#enable-python-pickling-of-c-objects" title="Permalink to this headline">¶</a></h2>
<p>In some cases we need our C++-wrapped objects to be picklable by Python. For
instance, if we need to use the object as part of the Python <code class="xref py py-obj docutils literal notranslate"><span class="pre">multiprocessing</span></code>
library, or if we want to implement some stop/resume functionality.</p>
<p>The way it has been done in a number of existing <code class="xref py py-obj docutils literal notranslate"><span class="pre">tick</span></code> classes is by
(de)serializing the object to and from string-types via the
<a class="reference external" href="http://uscilab.github.io/cereal/">Cereal</a> library.</p>
<p>In example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cereal/types/polymorphic.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cereal/types/base_class.hpp&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">HawkesKernelSumExp</span> <span class="o">:</span> <span class="k">public</span> <span class="n">HawkesKernel</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Archive</span><span class="o">&gt;</span>
  <span class="kt">void</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Archive</span> <span class="o">&amp;</span> <span class="n">ar</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ar</span><span class="p">(</span><span class="n">cereal</span><span class="o">::</span><span class="n">make_nvp</span><span class="p">(</span><span class="s">&quot;HawkesKernel&quot;</span><span class="p">,</span> <span class="n">cereal</span><span class="o">::</span><span class="n">base_class</span><span class="o">&lt;</span><span class="n">HawkesKernel</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>

    <span class="n">ar</span><span class="p">(</span><span class="n">CEREAL_NVP</span><span class="p">(</span><span class="n">use_fast_exp</span><span class="p">));</span>
    <span class="n">ar</span><span class="p">(</span><span class="n">CEREAL_NVP</span><span class="p">(</span><span class="n">n_decays</span><span class="p">));</span>
    <span class="n">ar</span><span class="p">(</span><span class="n">CEREAL_NVP</span><span class="p">(</span><span class="n">intensities</span><span class="p">));</span>
    <span class="n">ar</span><span class="p">(</span><span class="n">CEREAL_NVP</span><span class="p">(</span><span class="n">decays</span><span class="p">));</span>
    <span class="n">ar</span><span class="p">(</span><span class="n">CEREAL_NVP</span><span class="p">(</span><span class="n">last_convolution_time</span><span class="p">));</span>
    <span class="n">ar</span><span class="p">(</span><span class="n">CEREAL_NVP</span><span class="p">(</span><span class="n">last_convolution_values</span><span class="p">));</span>
    <span class="n">ar</span><span class="p">(</span><span class="n">CEREAL_NVP</span><span class="p">(</span><span class="n">convolution_restart_index</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>We add the serialize method, and in the method body we specify which members of
the class to put into the serialization archive. Note that members are wrapped
with <code class="xref py py-obj docutils literal notranslate"><span class="pre">CEREAL_NVP()</span></code>, which is a Cereal macro to add the value and <em>name</em> of a
variable. The standard tick classes such as <code class="xref py py-obj docutils literal notranslate"><span class="pre">ArrayDouble</span></code> can be added as
archive members without additional effort (e.g. intensities and decays in the
above example).</p>
<p>In the example above we also add the values of the base class (in this case
<code class="xref py py-obj docutils literal notranslate"><span class="pre">HawkesKernel</span></code>). Here we manually specify the value name with
<code class="xref py py-obj docutils literal notranslate"><span class="pre">cereal::make_nvp</span></code>.</p>
<p>This takes care of the C++-part of serialization. We add Pickle functionality
directly in the SWIG interface file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="p">{</span>
<span class="cp">#include</span> <span class="cpf">&quot;hawkes.h&quot;</span><span class="cp"></span>
<span class="o">%</span><span class="p">}</span>

<span class="o">%</span><span class="n">include</span> <span class="n">serialization</span><span class="p">.</span><span class="n">i</span>

<span class="k">class</span> <span class="nc">HawkesKernelSumExp</span> <span class="o">:</span> <span class="k">public</span> <span class="n">HawkesKernel</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>

  <span class="n">HawkesKernelSumExp</span><span class="p">();</span>

  <span class="p">...</span>
<span class="p">};</span>

<span class="n">TICK_MAKE_PICKLABLE</span><span class="p">(</span><span class="n">HawkesKernelSumExp</span><span class="p">);</span>
</pre></div>
</div>
<p>A convenience macro <code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_MAKE_PICKLABLE</span></code> is available to add all the necessary
bits to a SWIG definition in order to make it picklable in Python.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_MAKE_PICKLABLE</span></code> takes any number of arguments. The first being the class
name of the class to be pickled. Any following arguments will be forwarded to
the Python constructor of the class for initialization (used when
unpickling/reconstructing an object). In the example above, no parameters are
given to the constructor.</p>
<p>The macro adds a block of Python code with a <code class="xref py py-obj docutils literal notranslate"><span class="pre">__getstate__</span></code> method to return a
serialized copy of the object, and a <code class="xref py py-obj docutils literal notranslate"><span class="pre">__setstate__</span></code> method to reconstruct the
object from a string value (this is where the initialization/constructor
parameters play in).</p>
<p>Similarly, <code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_MAKE_TEMPLATED_PICKLABLE</span></code> is provided if needed to specify
a type with templated parameters.</p>
<p>It’s important to consider the initialization of the Python object. In some
cases it might be convenient to add a parameter-less C++ constructor that
initializes an empty object. Otherwise existing constructors should be used.</p>
<p>Now that the Python class has methods to get/set the object state, the pickle
module may work on the class.</p>
<div class="section" id="splitting-serialization-and-deserialization-methods">
<h3>Splitting serialization and deserialization methods<a class="headerlink" href="#splitting-serialization-and-deserialization-methods" title="Permalink to this headline">¶</a></h3>
<p>In some cases it’s convenient to split the serialization method into two; one
for loading (deserializing) and saving (serializing) an object. For example, if
an archive member needs complex initialization during loading, it may be easier
to have this done in a separate method.</p>
<p>In Cereal, we can define load and save methods separately:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Archive</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">save</span><span class="p">(</span><span class="n">Archive</span> <span class="o">&amp;</span> <span class="n">ar</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">ar</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">ar</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">ar</span><span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">get_foo</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Archive</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">load</span><span class="p">(</span><span class="n">Archive</span> <span class="o">&amp;</span> <span class="n">ar</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ar</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">ar</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

  <span class="kt">float</span> <span class="n">temp</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
  <span class="n">ar</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://uscilab.github.io/cereal/serialization_functions.html">Cereal website</a>
for more details.</p>
</div>
<div class="section" id="serializing-class-hierarchies">
<h3>Serializing class hierarchies<a class="headerlink" href="#serializing-class-hierarchies" title="Permalink to this headline">¶</a></h3>
<p>When serializing a class that is part of a hierarchy, it’s usually sufficient to
add the base class as one of the archive members, as shown in the example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Archive</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Archive</span> <span class="o">&amp;</span> <span class="n">ar</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">ar</span><span class="p">(</span><span class="n">cereal</span><span class="o">::</span><span class="n">make_nvp</span><span class="p">(</span><span class="s">&quot;HawkesKernel&quot;</span><span class="p">,</span> <span class="n">cereal</span><span class="o">::</span><span class="n">base_class</span><span class="o">&lt;</span><span class="n">HawkesKernel</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, if some base class in the hierarchy defines split save/load methods,
and a derived class defines a single serialize method (or vice versa), it may be
necessary to inform Cereal which serialization method(s) to use. Cereal provides
a macro to achieve this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Always use the single &#39;serialize&#39; method when serializing the Hawkes class</span>
<span class="n">CEREAL_SPECIALIZE_FOR_ALL_ARCHIVES</span><span class="p">(</span><span class="n">Hawkes</span><span class="p">,</span> <span class="n">cereal</span><span class="o">::</span><span class="n">specialization</span><span class="o">::</span><span class="n">member_serialize</span><span class="p">)</span>

<span class="c1">// OR</span>

<span class="c1">// Always use the split &#39;load/save&#39; methods when serializing the Hawkes class</span>
<span class="n">CEREAL_SPECIALIZE_FOR_ALL_ARCHIVES</span><span class="p">(</span><span class="n">Hawkes</span><span class="p">,</span> <span class="n">cereal</span><span class="o">::</span><span class="n">specialization</span><span class="o">::</span><span class="n">member_load_save</span><span class="p">)</span>
</pre></div>
</div>
<p>The macros need to be put after the definition of the classes, and in the global
namespace (i.e. not in tick).</p>
</div>
<div class="section" id="serializing-smart-pointers">
<h3>Serializing smart pointers<a class="headerlink" href="#serializing-smart-pointers" title="Permalink to this headline">¶</a></h3>
<p>Serializing smart pointers such as <code class="xref py py-obj docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">std::unique_ptr</span></code> is supported
by Cereal with a minimum of needed work.</p>
<p>An archive member of a smart pointer type is tagged with additional information
about the actual value type when serialized. For this to happen, Cereal needs to be
informed of the available derived classes of the base class that is serialized.</p>
<p>We do this in the following way:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">CEREAL_REGISTER_TYPE</span><span class="p">(</span><span class="n">DerivedClass</span><span class="p">)</span>
</pre></div>
</div>
<p>With this macro in place, Cereal will be able to save and restore values with the
correct polymorphic types. You can see more in the
<a class="reference external" href="https://uscilab.github.io/cereal/polymorphism.html">Cereal documentation on polymorphic types</a>.</p>
</div>
</div>
<div class="section" id="tips-for-debugging-c-classes-in-tick">
<h2>Tips for debugging C++ classes in tick<a class="headerlink" href="#tips-for-debugging-c-classes-in-tick" title="Permalink to this headline">¶</a></h2>
<p>In the header file <code class="xref py py-obj docutils literal notranslate"><span class="pre">debug.h</span></code> we have a number of macro definitions to aid in the development of the tick library.</p>
<div class="section" id="debug-output">
<h3>Debug output<a class="headerlink" href="#debug-output" title="Permalink to this headline">¶</a></h3>
<p>For the sake of convenience, <code class="xref py py-obj docutils literal notranslate"><span class="pre">debug.h</span></code> defines <code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_DEBUG()</span></code> and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_WARNING()</span></code> to print messages to stdout or stderr respectively. They are
both used as streaming interfaces:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ArrayDouble</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>

<span class="n">TICK_DEBUG</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Printing an array to stdout: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">arr</span><span class="p">;</span>
<span class="n">TICK_WARNING</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Printing an array to stderr: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">arr</span><span class="p">;</span>
</pre></div>
</div>
<p>Most types that can be inserted into std::stringstream can also be inserted into
these interfaces. Notice that <code class="xref py py-obj docutils literal notranslate"><span class="pre">tick</span></code> arrays can also be inserted.</p>
</div>
<div class="section" id="raising-errors">
<h3>Raising errors<a class="headerlink" href="#raising-errors" title="Permalink to this headline">¶</a></h3>
<p>To generate errors there is an similar macro which will raise a C++ exception to
be caught by Python. The interface is almost identical to <code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_DEBUG()</span></code> and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_WARNING()</span></code> except that the input must be placed within the parenthesis:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ArrayDouble</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>

<span class="n">TICK_ERROR</span><span class="p">(</span><span class="s">&quot;A fatal error occurred because of this array: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">arr</span><span class="p">);</span>
</pre></div>
</div>
<p>This will throw an exception which (if used via the Python interface) will be
caught in the SWIG interface layer and raised as an error in Python.</p>
<p>The exception thrown can include a backtrace to the point of error. For this to
happen, the compilation of the library must include the DEBUG_VERBOSE flag
(see <code class="xref py py-obj docutils literal notranslate"><span class="pre">setup.py</span></code>).</p>
</div>
<div class="section" id="deprecation">
<h3>Deprecation<a class="headerlink" href="#deprecation" title="Permalink to this headline">¶</a></h3>
<p>The library is under continuous development and occasionally some internal
implementations will be phased out. To ease this process the macro
<code class="xref py py-obj docutils literal notranslate"><span class="pre">TICK_DEPRECATED</span></code> is useful to mark variables or definition as no-longer-fit to
use. Code will still compile and link, but warnings will be generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.../tick/deprecated.cpp: In member function ‘void f()’:
.../tick/deprecated.cpp:20:3: warning: ‘int some_method()’ is deprecated (declared at .../deprecated.cpp:10) [-Wdeprecated-declarations]
</pre></div>
</div>
</div>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright Emmanuel Bacry, Martin Bompaire, Stephane Gaiffas, Maryan Morel, Søren Vinther Poulsen.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>